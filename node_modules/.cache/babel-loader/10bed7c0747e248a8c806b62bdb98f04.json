{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.keccak256 = keccak256;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _socket = require(\"socket.io-client\");\n\nvar _eccrypto = require(\"@toruslabs/eccrypto\");\n\nvar _metadataHelpers = require(\"@toruslabs/metadata-helpers\");\n\nvar _keccak = _interopRequireDefault(require(\"keccak\"));\n\nvar _util = require(\"../util\");\n\nvar _options = require(\"../options\");\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\n\nvar microSeconds = _util.microSeconds; // PASS IN STRING/BUFFER TO GET BUFFER\n\nexports.microSeconds = microSeconds;\n\nfunction keccak256(a) {\n  return (0, _keccak[\"default\"])('keccak256').update(a).digest();\n}\n\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'server';\nexports.type = type;\nvar SOCKET_CONN_INSTANCES = {};\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res, rej) {\n    (0, _util.sleep)().then( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n      var key, channelEncPrivKey, encData, socketConn, _setMessage, currentAttempts, waitingInterval;\n\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              key = storageKey(channelState.channelName);\n              channelEncPrivKey = keccak256(key);\n              _context3.next = 4;\n              return (0, _metadataHelpers.encryptData)(channelEncPrivKey.toString('hex'), {\n                token: (0, _util.randomToken)(),\n                time: new Date().getTime(),\n                data: messageJson,\n                uuid: channelState.uuid\n              });\n\n            case 4:\n              encData = _context3.sent;\n              socketConn = SOCKET_CONN_INSTANCES[channelState.channelName];\n\n              _setMessage = /*#__PURE__*/function () {\n                var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n                  return _regenerator[\"default\"].wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.t0 = fetch;\n                          _context.t1 = channelState.serverUrl + '/channel/set';\n                          _context.t2 = JSON;\n                          _context.t3 = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n                          _context.t4 = encData;\n                          _context.next = 7;\n                          return (0, _eccrypto.sign)(channelEncPrivKey, keccak256(encData));\n\n                        case 7:\n                          _context.t5 = _context.sent.toString('hex');\n                          _context.t6 = {\n                            key: _context.t3,\n                            data: _context.t4,\n                            signature: _context.t5\n                          };\n                          _context.t7 = _context.t2.stringify.call(_context.t2, _context.t6);\n                          _context.t8 = {\n                            'Content-Type': 'application/json; charset=utf-8'\n                          };\n                          _context.t9 = {\n                            method: 'POST',\n                            body: _context.t7,\n                            headers: _context.t8\n                          };\n                          return _context.abrupt(\"return\", (0, _context.t0)(_context.t1, _context.t9).then(res)[\"catch\"](rej));\n\n                        case 13:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function _setMessage() {\n                  return _ref2.apply(this, arguments);\n                };\n              }();\n\n              if (!(socketConn && socketConn.connected)) {\n                _context3.next = 9;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", _setMessage());\n\n            case 9:\n              currentAttempts = 0;\n              waitingInterval = window.setInterval( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n                return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        if (!(currentAttempts >= 5)) {\n                          _context2.next = 3;\n                          break;\n                        }\n\n                        window.clearInterval(waitingInterval);\n                        return _context2.abrupt(\"return\", rej(new Error('Could not post message after 5 attempts to socket channel')));\n\n                      case 3:\n                        if (!(socketConn && socketConn.connected)) {\n                          _context2.next = 8;\n                          break;\n                        }\n\n                        window.clearInterval(waitingInterval);\n                        return _context2.abrupt(\"return\", _setMessage());\n\n                      case 8:\n                        currentAttempts++;\n\n                      case 9:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2);\n              })), 500);\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    })));\n  });\n}\n\nfunction addStorageEventListener(channelName, serverUrl, fn) {\n  var key = storageKey(channelName);\n  var channelEncPrivKey = keccak256(key);\n  var SOCKET_CONN = (0, _socket.io)(serverUrl, {\n    transports: ['websocket', 'polling'],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n\n  var visibilityListener = function visibilityListener() {\n    // if channel is closed, then remove the listener.\n    if (!SOCKET_CONN_INSTANCES[channelName]) {\n      document.removeEventListener('visibilitychange', visibilityListener);\n      return;\n    } // if not connected, then wait for connection and ping server for latest msg.\n\n\n    if (!SOCKET_CONN.connected && document.visibilityState === 'visible') {\n      SOCKET_CONN.once('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4() {\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                SOCKET_CONN.emit('check_auth_status', (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex'));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      })));\n    }\n  };\n\n  var listener = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(ev) {\n      var decData;\n      return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return (0, _metadataHelpers.decryptData)(channelEncPrivKey.toString('hex'), ev);\n\n            case 3:\n              decData = _context5.sent;\n              fn(decData);\n              _context5.next = 10;\n              break;\n\n            case 7:\n              _context5.prev = 7;\n              _context5.t0 = _context5[\"catch\"](0);\n\n              _util.log.error(_context5.t0);\n\n            case 10:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 7]]);\n    }));\n\n    return function listener(_x) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  SOCKET_CONN.on('connect_error', function () {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = ['polling', 'websocket'];\n  });\n  SOCKET_CONN.on('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6() {\n    var engine;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _util.log.debug('connected with socket');\n\n            SOCKET_CONN.emit('check_auth_status', (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex'));\n            engine = SOCKET_CONN.io.engine;\n\n            _util.log.debug('initially connected to', engine.transport.name); // in most cases, prints \"polling\"\n\n\n            engine.once('upgrade', function () {\n              // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n              _util.log.debug('upgraded', engine.transport.name); // in most cases, prints \"websocket\"\n\n            });\n            engine.on('close', function (reason) {\n              // called when the underlying connection is closed\n              _util.log.debug('connection closed', reason);\n            });\n\n          case 6:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  })));\n  SOCKET_CONN.on('error', function (err) {\n    _util.log.debug('socket errored', err);\n\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN.once('disconnect', function () {\n    _util.log.debug('socket disconnected');\n\n    if (SOCKET_CONN_INSTANCES[channelName]) visibilityListener();\n  });\n  SOCKET_CONN.on('success', listener);\n  document.addEventListener('visibilitychange', visibilityListener);\n  SOCKET_CONN_INSTANCES[channelName] = SOCKET_CONN;\n  return listener;\n}\n\nfunction removeStorageEventListener(channelState) {\n  if (SOCKET_CONN_INSTANCES[channelState.channelName]) SOCKET_CONN_INSTANCES[channelState.channelName].disconnect();\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed(options)) {\n    throw new Error('BroadcastChannel: server cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.server.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs,\n    // emittedMessagesIds\n    serverUrl: options.server.url\n  };\n  state.listener = addStorageEventListener(channelName, options.server.url, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close(channelState) {\n  // give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  window.setTimeout(function () {\n    removeStorageEventListener(channelState);\n    delete SOCKET_CONN_INSTANCES[channelState.channelName];\n  }, 1000);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 500; // TODO: Maybe increase it based on operation\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","addStorageEventListener","averageResponseTime","canBeUsed","close","create","keccak256","microSeconds","onMessage","postMessage","removeStorageEventListener","storageKey","type","_regenerator","_asyncToGenerator2","_obliviousSet","_socket","_eccrypto","_metadataHelpers","_keccak","_util","_options","a","update","digest","KEY_PREFIX","SOCKET_CONN_INSTANCES","channelName","channelState","messageJson","Promise","res","rej","sleep","then","mark","_callee3","key","channelEncPrivKey","encData","socketConn","_setMessage","currentAttempts","waitingInterval","wrap","_callee3$","_context3","prev","next","encryptData","toString","token","randomToken","time","Date","getTime","data","uuid","sent","_ref2","_callee","_callee$","_context","t0","fetch","t1","serverUrl","t2","JSON","t3","getPublic","t4","sign","t5","t6","signature","t7","stringify","call","t8","t9","method","body","headers","abrupt","stop","apply","arguments","connected","window","setInterval","_callee2","_callee2$","_context2","clearInterval","Error","fn","SOCKET_CONN","io","transports","withCredentials","reconnectionDelayMax","reconnectionAttempts","visibilityListener","document","removeEventListener","visibilityState","once","_callee4","_callee4$","_context4","emit","listener","_ref5","_callee5","ev","decData","_callee5$","_context5","decryptData","log","error","_x","on","opts","_callee6","engine","_callee6$","_context6","debug","transport","name","reason","err","disconnect","addEventListener","options","fillOptionsWithDefaults","eMIs","ObliviousSet","server","removeTimeout","state","url","msgObj","messagesCallback","has","add","setTimeout","messagesCallbackTime","defaultTime","_default"],"sources":["C:/Users/crypt/Desktop/Sentiment Dapp/FirstDapp-Starter/node_modules/@toruslabs/broadcast-channel/dist/lib/methods/server.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addStorageEventListener = addStorageEventListener;\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.keccak256 = keccak256;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _socket = require(\"socket.io-client\");\n\nvar _eccrypto = require(\"@toruslabs/eccrypto\");\n\nvar _metadataHelpers = require(\"@toruslabs/metadata-helpers\");\n\nvar _keccak = _interopRequireDefault(require(\"keccak\"));\n\nvar _util = require(\"../util\");\n\nvar _options = require(\"../options\");\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nvar microSeconds = _util.microSeconds; // PASS IN STRING/BUFFER TO GET BUFFER\n\nexports.microSeconds = microSeconds;\n\nfunction keccak256(a) {\n  return (0, _keccak[\"default\"])('keccak256').update(a).digest();\n}\n\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'server';\nexports.type = type;\nvar SOCKET_CONN_INSTANCES = {};\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res, rej) {\n    (0, _util.sleep)().then( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n      var key, channelEncPrivKey, encData, socketConn, _setMessage, currentAttempts, waitingInterval;\n\n      return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              key = storageKey(channelState.channelName);\n              channelEncPrivKey = keccak256(key);\n              _context3.next = 4;\n              return (0, _metadataHelpers.encryptData)(channelEncPrivKey.toString('hex'), {\n                token: (0, _util.randomToken)(),\n                time: new Date().getTime(),\n                data: messageJson,\n                uuid: channelState.uuid\n              });\n\n            case 4:\n              encData = _context3.sent;\n              socketConn = SOCKET_CONN_INSTANCES[channelState.channelName];\n\n              _setMessage = /*#__PURE__*/function () {\n                var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n                  return _regenerator[\"default\"].wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.t0 = fetch;\n                          _context.t1 = channelState.serverUrl + '/channel/set';\n                          _context.t2 = JSON;\n                          _context.t3 = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n                          _context.t4 = encData;\n                          _context.next = 7;\n                          return (0, _eccrypto.sign)(channelEncPrivKey, keccak256(encData));\n\n                        case 7:\n                          _context.t5 = _context.sent.toString('hex');\n                          _context.t6 = {\n                            key: _context.t3,\n                            data: _context.t4,\n                            signature: _context.t5\n                          };\n                          _context.t7 = _context.t2.stringify.call(_context.t2, _context.t6);\n                          _context.t8 = {\n                            'Content-Type': 'application/json; charset=utf-8'\n                          };\n                          _context.t9 = {\n                            method: 'POST',\n                            body: _context.t7,\n                            headers: _context.t8\n                          };\n                          return _context.abrupt(\"return\", (0, _context.t0)(_context.t1, _context.t9).then(res)[\"catch\"](rej));\n\n                        case 13:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function _setMessage() {\n                  return _ref2.apply(this, arguments);\n                };\n              }();\n\n              if (!(socketConn && socketConn.connected)) {\n                _context3.next = 9;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", _setMessage());\n\n            case 9:\n              currentAttempts = 0;\n              waitingInterval = window.setInterval( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n                return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        if (!(currentAttempts >= 5)) {\n                          _context2.next = 3;\n                          break;\n                        }\n\n                        window.clearInterval(waitingInterval);\n                        return _context2.abrupt(\"return\", rej(new Error('Could not post message after 5 attempts to socket channel')));\n\n                      case 3:\n                        if (!(socketConn && socketConn.connected)) {\n                          _context2.next = 8;\n                          break;\n                        }\n\n                        window.clearInterval(waitingInterval);\n                        return _context2.abrupt(\"return\", _setMessage());\n\n                      case 8:\n                        currentAttempts++;\n\n                      case 9:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2);\n              })), 500);\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    })));\n  });\n}\n\nfunction addStorageEventListener(channelName, serverUrl, fn) {\n  var key = storageKey(channelName);\n  var channelEncPrivKey = keccak256(key);\n  var SOCKET_CONN = (0, _socket.io)(serverUrl, {\n    transports: ['websocket', 'polling'],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n\n  var visibilityListener = function visibilityListener() {\n    // if channel is closed, then remove the listener.\n    if (!SOCKET_CONN_INSTANCES[channelName]) {\n      document.removeEventListener('visibilitychange', visibilityListener);\n      return;\n    } // if not connected, then wait for connection and ping server for latest msg.\n\n\n    if (!SOCKET_CONN.connected && document.visibilityState === 'visible') {\n      SOCKET_CONN.once('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4() {\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                SOCKET_CONN.emit('check_auth_status', (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex'));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      })));\n    }\n  };\n\n  var listener = /*#__PURE__*/function () {\n    var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(ev) {\n      var decData;\n      return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return (0, _metadataHelpers.decryptData)(channelEncPrivKey.toString('hex'), ev);\n\n            case 3:\n              decData = _context5.sent;\n              fn(decData);\n              _context5.next = 10;\n              break;\n\n            case 7:\n              _context5.prev = 7;\n              _context5.t0 = _context5[\"catch\"](0);\n\n              _util.log.error(_context5.t0);\n\n            case 10:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[0, 7]]);\n    }));\n\n    return function listener(_x) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  SOCKET_CONN.on('connect_error', function () {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = ['polling', 'websocket'];\n  });\n  SOCKET_CONN.on('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6() {\n    var engine;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _util.log.debug('connected with socket');\n\n            SOCKET_CONN.emit('check_auth_status', (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex'));\n            engine = SOCKET_CONN.io.engine;\n\n            _util.log.debug('initially connected to', engine.transport.name); // in most cases, prints \"polling\"\n\n\n            engine.once('upgrade', function () {\n              // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n              _util.log.debug('upgraded', engine.transport.name); // in most cases, prints \"websocket\"\n\n            });\n            engine.on('close', function (reason) {\n              // called when the underlying connection is closed\n              _util.log.debug('connection closed', reason);\n            });\n\n          case 6:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  })));\n  SOCKET_CONN.on('error', function (err) {\n    _util.log.debug('socket errored', err);\n\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN.once('disconnect', function () {\n    _util.log.debug('socket disconnected');\n\n    if (SOCKET_CONN_INSTANCES[channelName]) visibilityListener();\n  });\n  SOCKET_CONN.on('success', listener);\n  document.addEventListener('visibilitychange', visibilityListener);\n  SOCKET_CONN_INSTANCES[channelName] = SOCKET_CONN;\n  return listener;\n}\n\nfunction removeStorageEventListener(channelState) {\n  if (SOCKET_CONN_INSTANCES[channelState.channelName]) SOCKET_CONN_INSTANCES[channelState.channelName].disconnect();\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed(options)) {\n    throw new Error('BroadcastChannel: server cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.server.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs,\n    // emittedMessagesIds\n    serverUrl: options.server.url\n  };\n  state.listener = addStorageEventListener(channelName, options.server.url, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close(channelState) {\n  // give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  window.setTimeout(function () {\n    removeStorageEventListener(channelState);\n    delete SOCKET_CONN_INSTANCES[channelState.channelName];\n  }, 1000);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 500; // TODO: Maybe increase it based on operation\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;"],"mappings":"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"},"metadata":{},"sourceType":"script"}